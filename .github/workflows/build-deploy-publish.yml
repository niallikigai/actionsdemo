name: 'Gradle - Build & Test'
on:
  workflow_dispatch:
  push:
    branches: [ '**', 'main' ]
env:
  MIN_COVERAGE: 70
jobs:
  build-test:
    name: Build and test
    permissions: write-all
    uses: niallikigai/actionsdemo/.github/workflows/gradle-build-template.yml@main
    with:
      minimum-coverage: 10
  push-ecr:
    name: Push to ECR
    runs-on: ubuntu-latest
    needs: build-test
    uses: niallikigai/actionsdemo/.github/workflows/push-to-ecr.yml@main
    environment: development
    outputs:
      image: ${{ steps.build-image.outputs.image }}
  artifact-cleanup:
    runs-on: ubuntu-latest
    needs: build-test
    if: always()
    steps:
      - name: Delete artifact
        uses: geekyeggo/delete-artifact@v2
        with:
          name: build-files


